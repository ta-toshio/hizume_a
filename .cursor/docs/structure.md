# ãƒãƒ£ã‚¯ãƒ©ã¨æ­¦é“ã®é¦¬è‚²æˆã‚²ãƒ¼ãƒ  - ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆæ§‹é€ è¨­è¨ˆæ›¸

## ğŸ“‚ ãƒ•ã‚©ãƒ«ãƒ€æ§‹æˆ

```
project_root/
â”‚
â”œâ”€â”€ ğŸ“‚ assets/              # å…¨ã¦ã®ã‚¢ã‚»ãƒƒãƒˆãƒ•ã‚¡ã‚¤ãƒ«
â”‚   â”œâ”€â”€ ğŸ“‚ images/          # ç”»åƒãƒ»ã‚¹ãƒ—ãƒ©ã‚¤ãƒˆ
â”‚   â”‚   â”œâ”€â”€ ğŸ“‚ ui/          # UIè¦ç´ ç”»åƒ
â”‚   â”‚   â”œâ”€â”€ ğŸ“‚ characters/  # ã‚­ãƒ£ãƒ©ã‚¯ã‚¿ãƒ¼ç”»åƒ
â”‚   â”‚   â””â”€â”€ ğŸ“‚ effects/     # ã‚¨ãƒ•ã‚§ã‚¯ãƒˆç”»åƒ
â”‚   â”‚
â”‚   â”œâ”€â”€ ğŸ“‚ fonts/           # ãƒ•ã‚©ãƒ³ãƒˆãƒ•ã‚¡ã‚¤ãƒ«
â”‚   â”œâ”€â”€ ğŸ“‚ audio/           # ã‚µã‚¦ãƒ³ãƒ‰ãƒ•ã‚¡ã‚¤ãƒ«
â”‚   â”‚   â”œâ”€â”€ ğŸ“‚ bgm/         # BGM
â”‚   â”‚   â””â”€â”€ ğŸ“‚ sfx/         # åŠ¹æœéŸ³
â”‚   â”‚
â”‚   â””â”€â”€ ğŸ“‚ shaders/         # ã‚·ã‚§ãƒ¼ãƒ€ãƒ¼ãƒ•ã‚¡ã‚¤ãƒ«
â”‚
â”œâ”€â”€ ğŸ“‚ data/                 # JSONãƒ‡ãƒ¼ã‚¿ï¼ˆãƒã‚¹ã‚¿ãƒ¼ãƒ‡ãƒ¼ã‚¿ï¼‰
â”‚   â”œâ”€â”€ ğŸ“‚ horses/           # é¦¬ãƒ‡ãƒ¼ã‚¿
â”‚   â”œâ”€â”€ ğŸ“‚ equipment/        # è£…å‚™ãƒ‡ãƒ¼ã‚¿
â”‚   â”œâ”€â”€ ğŸ“‚ skills/           # ã‚¹ã‚­ãƒ«ãƒ‡ãƒ¼ã‚¿
â”‚   â”œâ”€â”€ ğŸ“‚ training/         # ãƒˆãƒ¬ãƒ¼ãƒ‹ãƒ³ã‚°ãƒ‡ãƒ¼ã‚¿
â”‚   â””â”€â”€ ğŸ“‚ events/           # ã‚¤ãƒ™ãƒ³ãƒˆãƒ‡ãƒ¼ã‚¿
â”‚
â”œâ”€â”€ ğŸ“‚ scenes/               # ã‚·ãƒ¼ãƒ³ï¼ˆç”»é¢ï¼‰
â”‚   â”œâ”€â”€ ğŸ“‚ ui/               # UIå…±é€šã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ
â”‚   â”œâ”€â”€ ğŸ“‚ training/         # ãƒˆãƒ¬ãƒ¼ãƒ‹ãƒ³ã‚°ç”»é¢
â”‚   â”œâ”€â”€ ğŸ“‚ race/             # ãƒ¬ãƒ¼ã‚¹ç”»é¢
â”‚   â””â”€â”€ ğŸ“‚ common/           # å…±é€šã‚·ãƒ¼ãƒ³
â”‚
â”œâ”€â”€ ğŸ“‚ scripts/              # GDScriptãƒ•ã‚¡ã‚¤ãƒ«
â”‚   â”œâ”€â”€ ğŸ“‚ core/             # ã‚³ã‚¢ã‚·ã‚¹ãƒ†ãƒ 
â”‚   â”œâ”€â”€ ğŸ“‚ models/           # ãƒ‡ãƒ¼ã‚¿ãƒ¢ãƒ‡ãƒ«
â”‚   â”œâ”€â”€ ğŸ“‚ managers/         # çŠ¶æ…‹ç®¡ç†
â”‚   â”œâ”€â”€ ğŸ“‚ ui/               # UIåˆ¶å¾¡
â”‚   â”œâ”€â”€ ğŸ“‚ utils/            # ãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£
â”‚   â””â”€â”€ ğŸ“‚ effects/          # ã‚¨ãƒ•ã‚§ã‚¯ãƒˆå‡¦ç†
â”‚
â”œâ”€â”€ ğŸ“‚ addons/               # ãƒ—ãƒ©ã‚°ã‚¤ãƒ³
â””â”€â”€ ğŸ“‚ saves/                # ã‚»ãƒ¼ãƒ–ãƒ‡ãƒ¼ã‚¿ï¼ˆãƒ­ãƒ¼ã‚«ãƒ«ï¼‰
```

## ğŸ§© ã‚¯ãƒ©ã‚¹è¨­è¨ˆ

### ã‚³ã‚¢ãƒ»ç®¡ç†ã‚·ã‚¹ãƒ†ãƒ 

#### GameManager (ã‚·ãƒ³ã‚°ãƒ«ãƒˆãƒ³)
```gdscript
class_name GameManager extends Node
# ã‚²ãƒ¼ãƒ å…¨ä½“ã®çŠ¶æ…‹ç®¡ç†

var current_state: String        # ç¾åœ¨ã®ã‚²ãƒ¼ãƒ çŠ¶æ…‹
var player_data: PlayerData      # ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ãƒ‡ãƒ¼ã‚¿å‚ç…§
var training_manager: TrainingManager  # ãƒˆãƒ¬ãƒ¼ãƒ‹ãƒ³ã‚°ç®¡ç†
var race_manager: RaceManager    # ãƒ¬ãƒ¼ã‚¹ç®¡ç†
var data_loader: DataLoader      # ãƒ‡ãƒ¼ã‚¿ãƒ­ãƒ¼ãƒ€ãƒ¼

# ä¸»è¦ãƒ¡ã‚½ãƒƒãƒ‰
func change_state(new_state: String) -> void
func save_game() -> void
func load_game() -> void
func start_training() -> void
func start_race() -> void
```

#### TrainingManager
```gdscript
class_name TrainingManager extends Node
# è‚²æˆã‚µã‚¤ã‚¯ãƒ«ç®¡ç†

var current_turn: int
var current_month: String
var fatigue: int
var chakra_flow: String  # ç¾åœ¨ã®ãƒãƒ£ã‚¯ãƒ©æ°—é…ã‚«ãƒ†ã‚´ãƒª
var resonance_gauge: int  # è£œåŠ©ã‚²ãƒ¼ã‚¸
var stagnation_count: Dictionary  # ã‚«ãƒ†ã‚´ãƒªã”ã¨ã®é€£ç¶šä½¿ç”¨å›æ•°

# ä¸»è¦ãƒ¡ã‚½ãƒƒãƒ‰
func start_new_month() -> void  # æ–°ã—ã„æœˆã®å‡¦ç†é–‹å§‹
func select_training(category: String) -> void  # ãƒˆãƒ¬ãƒ¼ãƒ‹ãƒ³ã‚°é¸æŠ
func execute_training() -> void  # ãƒˆãƒ¬ãƒ¼ãƒ‹ãƒ³ã‚°å®Ÿè¡Œ
func calculate_growth() -> Dictionary  # æˆé•·è¨ˆç®—
func check_resonance() -> bool  # å…±é³´ãƒã‚§ãƒƒã‚¯
func update_skill_progress() -> void  # ã‚¹ã‚­ãƒ«é€²è¡Œæ›´æ–°
func update_familiarity() -> void  # ç†Ÿåº¦æ›´æ–°
func rest() -> void  # ä¼‘é¤Šå‡¦ç†
```

#### RaceManager
```gdscript
class_name RaceManager extends Node
# ãƒ¬ãƒ¼ã‚¹å‡¦ç†ç®¡ç†

var current_section: int  # ç¾åœ¨ã®åŒºé–“
var race_scores: Dictionary  # å„é¦¬ã®ã‚¹ã‚³ã‚¢
var activated_skills: Array  # ç™ºå‹•ã‚¹ã‚­ãƒ«ä¸€è¦§

# ä¸»è¦ãƒ¡ã‚½ãƒƒãƒ‰
func start_race() -> void
func calculate_section_score() -> void  # åŒºé–“ã‚¹ã‚³ã‚¢è¨ˆç®—
func process_skills() -> void  # ã‚¹ã‚­ãƒ«ç™ºå‹•å‡¦ç†
func update_positions() -> void  # é †ä½æ›´æ–°
func finish_race() -> Dictionary  # ãƒ¬ãƒ¼ã‚¹çµæœå–å¾—
```

#### DataLoader
```gdscript
class_name DataLoader extends Node
# ãƒã‚¹ã‚¿ãƒ¼ãƒ‡ãƒ¼ã‚¿ãƒ­ãƒ¼ãƒ‰ç®¡ç†

var horses_data: Dictionary
var equipment_data: Dictionary
var skills_data: Dictionary
var training_data: Dictionary
var events_data: Dictionary

# ä¸»è¦ãƒ¡ã‚½ãƒƒãƒ‰
func load_all_data() -> void
func get_horse_by_id(id: String) -> Dictionary
func get_equipment_by_id(id: String) -> Dictionary
func get_skill_by_id(id: String) -> Dictionary
func get_random_training(category: String) -> Dictionary
func get_random_event(condition: Dictionary) -> Dictionary
```

### ãƒ‡ãƒ¼ã‚¿ãƒ¢ãƒ‡ãƒ«

#### PlayerData
```gdscript
class_name PlayerData extends Resource
# ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼é€²è¡Œãƒ‡ãƒ¼ã‚¿

var player_name: String
var current_horse: Horse
var equipped_items: Dictionary  # ã‚«ãƒ†ã‚´ãƒªâ†’è£…å‚™IDã®ãƒãƒƒãƒ”ãƒ³ã‚°
var acquired_skills: Array
var training_history: Array
var race_results: Array

# ä¸»è¦ãƒ¡ã‚½ãƒƒãƒ‰
func equip_item(category: String, item_id: String) -> void
func add_skill(skill_id: String) -> void
func add_training_record(record: Dictionary) -> void
func add_race_result(result: Dictionary) -> void
func get_total_score() -> int
```

#### Horse
```gdscript
class_name Horse extends Resource
# è‚²æˆå¯¾è±¡ã®é¦¬ãƒ‡ãƒ¼ã‚¿

var id: String
var name: String
var stats: StatBlock
var aptitude: Array  # å¾—æ„ã‚«ãƒ†ã‚´ãƒª
var growth_rates: Dictionary  # æˆé•·ç‡

# ä¸»è¦ãƒ¡ã‚½ãƒƒãƒ‰
func increase_stat(stat_name: String, amount: int) -> void
func calculate_race_score(section: String) -> float
func get_best_category() -> String
```

#### StatBlock
```gdscript
class_name StatBlock extends Resource
# ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ãƒ–ãƒ­ãƒƒã‚¯

# ä¸»è¦ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹
var speed: int = 0
var stamina: int = 0
var technique: int = 0
var mental: int = 0
var flexibility: int = 0
var intellect: int = 0

# è£œåŠ©ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ï¼ˆã‚ªãƒ—ã‚·ãƒ§ãƒ³ï¼‰
var secondary_stats = {
    "reaction": 0,
    "balance": 0,
    "focus": 0,
    "adaptability": 0,
    "judgment": 0,
    "recovery": 0
}

# ä¸»è¦ãƒ¡ã‚½ãƒƒãƒ‰
func get_main_stats() -> Dictionary
func get_all_stats() -> Dictionary
func increase(stat_name: String, amount: int) -> void
func get_total() -> int
```

#### Equipment
```gdscript
class_name Equipment extends Resource
# è£…å‚™ãƒ‡ãƒ¼ã‚¿

var id: String
var name: String
var category: String  # 'rider', 'horse', 'manual'
var rarity: String
var related_training: String
var effects: Array
var associated_skills: Array
var familiarity: int = 0  # ç†Ÿåº¦å€¤
var familiarity_level: int = 1  # ç†Ÿåº¦ãƒ¬ãƒ™ãƒ«

# ä¸»è¦ãƒ¡ã‚½ãƒƒãƒ‰
func get_effect_value(effect_type: String) -> float
func increase_familiarity(amount: int) -> bool  # ãƒ¬ãƒ™ãƒ«ã‚¢ãƒƒãƒ—æ™‚ã¯true
func calculate_resonance_bonus() -> float
```

#### Skill
```gdscript
class_name Skill extends Resource
# ã‚¹ã‚­ãƒ«ãƒ‡ãƒ¼ã‚¿

var id: String
var name: String
var description: String
var effect: Dictionary
var condition: Dictionary
var category_tags: Array
var required_training: Array
var progress: int = 0
var progress_threshold: int = 5
var is_bloomed: bool = false

# ä¸»è¦ãƒ¡ã‚½ãƒƒãƒ‰
func increase_progress(amount: int) -> bool  # é–‹èŠ±æ™‚ã¯true
func check_activation_condition(race_state: Dictionary) -> bool
func apply_effect(race_state: Dictionary) -> Dictionary
func get_effect_value() -> float
```

### UIç®¡ç†

#### UIManager
```gdscript
class_name UIManager extends Node
# UIç®¡ç†ãƒ»ç”»é¢é·ç§»

var current_screen: String
var ui_stack: Array  # ç”»é¢ã‚¹ã‚¿ãƒƒã‚¯

# ä¸»è¦ãƒ¡ã‚½ãƒƒãƒ‰
func change_screen(screen_name: String) -> void
func push_screen(screen_name: String) -> void  # ç”»é¢ã‚¹ã‚¿ãƒƒã‚¯è¿½åŠ 
func pop_screen() -> void  # ç”»é¢ã‚¹ã‚¿ãƒƒã‚¯æˆ»ã‚‹
func show_popup(popup_name: String, data: Dictionary) -> void
func update_training_ui() -> void
func update_race_ui() -> void
func show_status_effect(effect_type: String, amount: int) -> void
```

#### TrainingScreen
```gdscript
class_name TrainingScreen extends Control
# ãƒˆãƒ¬ãƒ¼ãƒ‹ãƒ³ã‚°ç”»é¢UI

# UIè¦ç´ å‚ç…§
var status_panel: Control
var training_options: Control
var fatigue_bar: ProgressBar
var resonance_gauge: Control

# ä¸»è¦ãƒ¡ã‚½ãƒƒãƒ‰
func _ready() -> void
func update_training_options() -> void
func show_selected_training_detail(training_id: String) -> void
func show_training_result(result: Dictionary) -> void
func update_status_display() -> void
func update_skill_progress() -> void
func update_familiarity_bars() -> void
func show_resonance_effect() -> void
```

#### RaceScreen
```gdscript
class_name RaceScreen extends Control
# ãƒ¬ãƒ¼ã‚¹ç”»é¢UI

# UIè¦ç´ å‚ç…§
var section_indicator: Control
var horse_positions: Control
var skill_log: RichTextLabel
var result_panel: Control

# ä¸»è¦ãƒ¡ã‚½ãƒƒãƒ‰
func _ready() -> void
func start_race_animation() -> void
func update_section(section: String) -> void
func update_horse_positions() -> void
func show_skill_activation(skill_name: String) -> void
func show_section_result() -> void
func show_final_result() -> void
```

## ğŸ”„ ä¸»è¦ãƒ‡ãƒ¼ã‚¿ãƒ•ãƒ­ãƒ¼

### è‚²æˆã‚µã‚¤ã‚¯ãƒ«
1. `GameManager` â†’ `TrainingManager.start_new_month()`
2. æœˆæ¬¡ãƒãƒ£ã‚¯ãƒ©æ°—é…æ±ºå®š
3. UIè¡¨ç¤ºæ›´æ–°
4. ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ãŒãƒˆãƒ¬ãƒ¼ãƒ‹ãƒ³ã‚°é¸æŠ
5. `TrainingManager.execute_training()`
6. ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ãƒ»ã‚¹ã‚­ãƒ«ãƒ»ç†Ÿåº¦ã®æ›´æ–°
7. UIæ¼”å‡ºã¨æ¬¡ã®æœˆã¸

### ãƒ¬ãƒ¼ã‚¹ãƒ•ãƒ­ãƒ¼
1. `GameManager` â†’ `RaceManager.start_race()`
2. åŒºé–“ã”ã¨ã«ãƒ«ãƒ¼ãƒ—:
   - `RaceManager.calculate_section_score()`
   - `RaceManager.process_skills()`
   - `RaceManager.update_positions()`
   - UIæ›´æ–°ã¨æ¼”å‡º
3. `RaceManager.finish_race()`
4. çµæœè¡¨ç¤ºã¨è¨˜éŒ²

## ğŸ’¾ ä¿å­˜ã‚·ã‚¹ãƒ†ãƒ 

### ã‚»ãƒ¼ãƒ–ãƒ‡ãƒ¼ã‚¿æ§‹é€ 
```gdscript
{
    "player_name": String,
    "current_horse": Dictionary,  # Horse ãƒ‡ãƒ¼ã‚¿
    "current_turn": int,
    "fatigue": int,
    "equipped_items": Dictionary,
    "stats": Dictionary,  # StatBlock ãƒ‡ãƒ¼ã‚¿
    "skills": Array,  # å–å¾—ã‚¹ã‚­ãƒ«ä¸€è¦§
    "familiarity": Dictionary,  # è£…å‚™IDâ†’ç†Ÿåº¦å€¤ã®ãƒãƒƒãƒ—
    "race_results": Array,  # ãƒ¬ãƒ¼ã‚¹çµæœå±¥æ­´
    "skill_progress": Dictionary  # ã‚¹ã‚­ãƒ«IDâ†’é€²è¡Œå€¤ã®ãƒãƒƒãƒ—
}
```

### ã‚»ãƒ¼ãƒ–ãƒ­ãƒ¼ãƒ‰å‡¦ç†
- `GameManager.save_game()` â†’ JSONã¨ã—ã¦ãƒ•ã‚¡ã‚¤ãƒ«ä¿å­˜
- `GameManager.load_game()` â†’ ãƒ•ã‚¡ã‚¤ãƒ«ã‹ã‚‰èª­ã¿è¾¼ã¿ï¼†çŠ¶æ…‹å¾©å…ƒ

## ğŸ”„ çŠ¶æ…‹é·ç§»

### ã‚²ãƒ¼ãƒ ã‚¹ãƒ†ãƒ¼ãƒˆ
- `TitleState`: ã‚¿ã‚¤ãƒˆãƒ«ç”»é¢
- `HomeState`: ãƒ›ãƒ¼ãƒ ç”»é¢
- `HorseSelectState`: é¦¬é¸æŠ
- `EquipmentSelectState`: è£…å‚™é¸æŠ
- `TrainingState`: ãƒˆãƒ¬ãƒ¼ãƒ‹ãƒ³ã‚°
- `EventState`: ã‚¤ãƒ™ãƒ³ãƒˆç™ºç”Ÿä¸­
- `RaceState`: ãƒ¬ãƒ¼ã‚¹å®Ÿè¡Œä¸­
- `ResultState`: çµæœç”»é¢

### æ¡ä»¶é·ç§»
- ãƒˆãƒ¬ãƒ¼ãƒ‹ãƒ³ã‚° â†’ ãƒ¬ãƒ¼ã‚¹: ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼é¸æŠ or æœŸé–“æº€äº†
- ãƒˆãƒ¬ãƒ¼ãƒ‹ãƒ³ã‚° â†’ ã‚¤ãƒ™ãƒ³ãƒˆ: ãƒ©ãƒ³ãƒ€ãƒ ç™ºç”Ÿ
- ãƒ¬ãƒ¼ã‚¹çµ‚äº† â†’ ãƒˆãƒ¬ãƒ¼ãƒ‹ãƒ³ã‚°: ã¾ã è‚²æˆæœŸé–“å†…
- ãƒ¬ãƒ¼ã‚¹çµ‚äº† â†’ çµæœ: è‚²æˆæœŸé–“çµ‚äº† 